- name: Install helmfile
  shell: "curl -Lf https://github.com/helmfile/helmfile/releases/download/v0.162.0/helmfile_0.162.0_linux_amd64.tar.gz -o helmfile.tar.gz && tar -xvf helmfile.tar.gz && chmod +x helmfile && mv helmfile /usr/local/bin/helmfile"
  args:
    creates: /usr/local/bin/helmfile
  become: true
- name: Install helm diff plugin
  shell: helm plugin install https://github.com/databus23/helm-diff
- name: Copy helmfile and values files
  copy:
    src: "./files/{{item}}"
    dest: "/tmp/{{item}}"
  loop:
  - ingress-nginx-values.yaml
  - metrics-server-values.yaml
  - helmfile.yaml
- name: Install local-path-provisioner
  shell: "kubectl apply -f https://raw.githubusercontent.com/rancher/local-path-provisioner/v0.0.26/deploy/local-path-storage.yaml"
- name: Install Helm charts
  shell: "helmfile apply"
  args: 
    chdir: /tmp
