- set_fact:
    arch: "{{ architecture[ansible_architecture|lower] }}"

- name: Download control plane release
  ansible.builtin.get_url:
    url: https://k8sbinaries.s3.ap-south-1.amazonaws.com/v1.30.0/kubernetes-server-linux-arm64.tar.gz?response-content-disposition=inline&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCmFwLXNvdXRoLTEiRzBFAiEAyu29k3QgDqJ%2BNvb9RfRaCXUVZVdx2coqs0bUmoIwGwYCIGtai%2BFWTRJc%2BONEih3zckG0vlbSnROhTLxzsoJeSeo1KuQCCD8QBBoMNzc3NDQ2MjE5MTA2IgwVyDLYsUHjbjvqkK8qwQLbRY52yLqdCwvmy3%2B2yMWn6lBCDQMXNuh3RtnNtCWg2EE9BuIf%2BjPQVoYMzESbQosjLX0Gb6%2Bu3mJGiRerPcVXTRgt0zujEigzaVIl2Kyq0EHO9C3t4BNiTmAQMXbKYu%2B5OatTEuXO5baX9t%2FIBxo0QqWhUqhwzMH5UzXDqd2%2Bj%2Bt7iz9VHQJ9lzxFSi%2F0E8Jh3SlIFe1hYOJgMQS6AsjdNilvVsP3QbJ6ijQ55iF9ZBuWsS1vcXe1tSZxpeVd6J4Ym28GeB27h9eYaz94jRWGHvX0VnhlR1A0Qf9jZdRMZrPRleVgTc%2FaiTHWp14sP4X7rvg5%2Bv3rEG%2FONUjMN8Rug1GhN0BpgKxfBBV1ydaYTuP3BiFJ5nDKVWUluoLYzumGkDegUBqtp3jKtSsI8x197MtgVC6TGbJBs1uP%2FCkEsdcwg4f8sQY6swKPyl%2Bv0aI5fdQSb8%2FrpGZcgspJLY6mwCxSsikuqVvMKah%2Btl7vjWZ%2F6PqyFAaH5VBSRthBcY%2F3l3r8jY7xeh%2FgGBZnAV6%2FQkGmcjc%2BfxGUUEovtJFR8CyE%2FfbuFNpjVbQP8ky%2FwAwvAunJ08O1wPMzrx7u3KOZx4MHLX7boQhG%2FYyCcSwg6bzSzyrhnFJP06gpPzDHI2YyPq6pUJ7P0n8%2Fqx3rcaBPkhAcLPyR8Um71snGkn%2Fner0wbD7BUAU1Y7%2BWe290iVut9jREQen3Gur6L13gjgt8j%2BArlN9pbe%2F7pPiONjjecvESS2H7DXn33JQeTu77freBvW4zh%2FLIKFclzxANH0lTgNs5VXycZ%2BFM2pwQid7NMTBqs7mLfdqmUW2Rpi8Lncyllk3Ax24F84ndHWBS&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20240511T053614Z&X-Amz-SignedHeaders=host&X-Amz-Expires=43200&X-Amz-Credential=ASIA3KA3H3VRGNRSC7UW%2F20240511%2Fap-south-1%2Fs3%2Faws4_request&X-Amz-Signature=2604e053c853a0e3fcf52cf676c3335e1ef7e8f85f4b3e80657af8cce85117b0
    # url: "{{ download_url }}/v{{ kubernetes_version }}/kubernetes-server-{{ansible_system | lower}}-{{ arch }}.tar.gz"
    dest: "/tmp/kubernetes-server-v{{ kubernetes_version }}-{{ansible_system | lower}}-{{ arch }}.tar.gz"
    force: false
    mode: '0755'
  async: 600
  poll: 0
  register: cp_download
